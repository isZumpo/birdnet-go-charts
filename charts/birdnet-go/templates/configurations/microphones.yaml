{{- range $index, $microphone := .Values.microphones }}
apiVersion: akri.sh/v0
kind: Configuration
metadata:
  name: {{ template "birdnet-go.fullname" $ }}-mic-{{ $microphone.name }}
  labels:
    app: {{ template "birdnet-go.name" $ }}
    chart: {{ template "birdnet-go.chart" $ }}
    release: {{ $.Release.Name }}
    heritage: {{ $.Release.Service }}
spec:
  capacity: 1
  discoveryHandler:
    discoveryDetails: |
      {{- if $microphone.udevRules }}
      groupRecursive: true
      udevRules:
        {{- range $microphone.udevRules }}
        - {{ . }}
        {{- end }}
      {{- end }}
    name: udev
---
{{- end }}
